{"version":3,"file":"edu.min.js","sources":["../src/edu.js"],"sourcesContent":["// This file is part of edu-sharing created by metaVentis GmbH — http://metaventis.com\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @copyright  metaVentis GmbH — http://metaventis.com\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {getSecuredNode} from \"./repository\";\nimport Config from 'core/config';\n\nexport const start = () => {\n    const allEduSharingObjects = document.querySelectorAll(\"div[data-type='esObject']\");\n\n    const options = {\n        root: null,\n        rootMargin: \"400px\",\n        threshold: 0\n    };\n\n    const observerCallback = async(entries, observer) => {\n        window.console.log(\"OBSERVER CALLBACK\");\n        for (const entry of entries) {\n            window.console.log(\"ENTRY TO RENDER\");\n            window.console.log(entry.target);\n            await renderObject(entry.target);\n            observer.unobserve(entry.target);\n        }\n    };\n\n    /**\n     * @param {Element} element\n     */\n    const renderObject = async(element) => {\n        const wrapper = element.parentElement;\n        const nodeId = element.getAttribute('data-node');\n        const ajaxParams = {\n            eduSecuredNodeStructure: {\n                nodeId: nodeId\n            }\n        };\n        const response = await getSecuredNode(ajaxParams).catch(error => {\n            window.console.error(error);\n        });\n\n        const testUser = {\n            authorityName: \"authorName\",\n            firstName: \"Horst\",\n            surName: \"Tester\",\n            userEMail: \"mail@mail.de\"\n        };\n        const serviceWorkerPhp = `${Config.wwwroot}/filter/edusharing/getServiceWorker.php`;\n        const renderComponent = document.createElement('edu-sharing-render');\n        renderComponent.setAttribute(\"encoded_node\", response.securedNode);\n        renderComponent.setAttribute(\"signature\", response.signature);\n        renderComponent.setAttribute(\"jwt\", response.jwt);\n        renderComponent.setAttribute(\"render_url\", response.renderingBaseUrl);\n        renderComponent.setAttribute(\"encoded_user\", btoa(JSON.stringify(testUser)));\n        renderComponent.setAttribute(\"service_worker_url\", serviceWorkerPhp);\n        wrapper.innerHTML = \"\";\n        wrapper.appendChild(renderComponent);\n    };\n\n    const observer = new IntersectionObserver(observerCallback, options);\n    allEduSharingObjects.forEach(element => observer.observe(element));\n};\n"],"names":["allEduSharingObjects","document","querySelectorAll","renderObject","async","wrapper","element","parentElement","ajaxParams","eduSecuredNodeStructure","nodeId","getAttribute","response","catch","error","window","console","serviceWorkerPhp","Config","wwwroot","renderComponent","createElement","setAttribute","securedNode","signature","jwt","renderingBaseUrl","btoa","JSON","stringify","authorityName","firstName","surName","userEMail","innerHTML","appendChild","observer","IntersectionObserver","entries","log","entry","target","unobserve","root","rootMargin","threshold","forEach","observe"],"mappings":";;;;0JAuBqB,WACXA,qBAAuBC,SAASC,iBAAiB,6BAqBjDC,aAAeC,MAAAA,gBACXC,QAAUC,QAAQC,cAElBC,WAAa,CACfC,wBAAyB,CACrBC,OAHOJ,QAAQK,aAAa,eAM9BC,eAAiB,8BAAeJ,YAAYK,OAAMC,QACpDC,OAAOC,QAAQF,MAAMA,UASnBG,2BAAsBC,gBAAOC,mDAC7BC,gBAAkBnB,SAASoB,cAAc,sBAC/CD,gBAAgBE,aAAa,eAAgBV,SAASW,aACtDH,gBAAgBE,aAAa,YAAaV,SAASY,WACnDJ,gBAAgBE,aAAa,MAAOV,SAASa,KAC7CL,gBAAgBE,aAAa,aAAcV,SAASc,kBACpDN,gBAAgBE,aAAa,eAAgBK,KAAKC,KAAKC,UAZtC,CACbC,cAAe,aACfC,UAAW,QACXC,QAAS,SACTC,UAAW,mBASfb,gBAAgBE,aAAa,qBAAsBL,kBACnDZ,QAAQ6B,UAAY,GACpB7B,QAAQ8B,YAAYf,kBAGlBgB,SAAW,IAAIC,sBA3CIjC,MAAMkC,QAASF,YACpCrB,OAAOC,QAAQuB,IAAI,yBACd,MAAMC,SAASF,QAChBvB,OAAOC,QAAQuB,IAAI,mBACnBxB,OAAOC,QAAQuB,IAAIC,MAAMC,cACnBtC,aAAaqC,MAAMC,QACzBL,SAASM,UAAUF,MAAMC,UAZjB,CACZE,KAAM,KACNC,WAAY,QACZC,UAAW,IA+Cf7C,qBAAqB8C,SAAQxC,SAAW8B,SAASW,QAAQzC"}