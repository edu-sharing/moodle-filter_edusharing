define("filter_edusharing/edu",["exports","./repository","core/config"],(function(_exports,_repository,_config){var obj;
/**
   * @copyright  metaVentis GmbH â€” http://metaventis.com
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.start=void 0,_config=(obj=_config)&&obj.__esModule?obj:{default:obj};_exports.start=repoUrl=>{const allEduSharingObjects=document.querySelectorAll("div[data-type='esObject']"),renderObject=async element=>{const wrapper=element.parentElement,width=element.getAttribute("data-width"),nodeId=element.getAttribute("data-node"),containerId=element.getAttribute("data-container"),version=element.getAttribute("data-version"),usage=element.getAttribute("data-usage"),resourceId=element.getAttribute("data-resource"),resourceUrl="".concat(_config.default.wwwroot,"/filter/edusharing/inlineHelper.php?")+"nodeId=".concat(nodeId,"&nodeVersion=").concat(version,"&usageId=").concat(usage,"&resourceId=").concat(resourceId,"&containerId=").concat(containerId),ajaxParams={eduSecuredNodeStructure:{nodeId:nodeId,resourceId:resourceId}},response=await(0,_repository.getSecuredNode)(ajaxParams).catch((error=>{window.console.error(error)})),customWidth=response.customWidth;customWidth?"none"!==customWidth&&(wrapper.style.width=customWidth):wrapper.style.width=width?width+"px":"";const moodleUser=await(0,_repository.getCurrentUser)().catch((error=>{window.console.error(error)})),eduUser={authorityName:moodleUser.username,firstName:moodleUser.firstname,surName:moodleUser.lastname,userEMail:moodleUser.email},serviceWorkerPhp="".concat(_config.default.wwwroot,"/filter/edusharing/getServiceWorker.php");"serviceWorker"in navigator&&await navigator.serviceWorker.register(serviceWorkerPhp,{scope:"/"});const renderComponent=document.createElement("edu-sharing-render");renderComponent.classList.add("edu-sharing-render"),renderComponent.encoded_node=response.securedNode,renderComponent.signature=response.signature,renderComponent.jwt=response.jwt,renderComponent.render_url=response.renderingBaseUrl,renderComponent.encoded_user=btoa(JSON.stringify(eduUser)),renderComponent.service_worker_url=serviceWorkerPhp,renderComponent.activate_service_worker=!1,renderComponent.assets_url=repoUrl+"/web-components/rendering-service-amd/assets",renderComponent.resource_url=resourceUrl,renderComponent.preview_url=response.previewUrl,wrapper.innerHTML="",wrapper.appendChild(renderComponent)},observer=new IntersectionObserver((async(entries,observer)=>{for(const entry of entries)await renderObject(entry.target),observer.unobserve(entry.target)}),{root:null,rootMargin:"400px",threshold:0});allEduSharingObjects.forEach((element=>observer.observe(element)))}}));

//# sourceMappingURL=edu.min.js.map